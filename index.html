<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PWA Rilevazione Pasti</title>
<style>
  body {
    font-family: sans-serif;
    padding: 1rem;
    background: #f4f6f8;
    font-size: 20px;
  }
  h1 { text-align: center; font-size: 24px; margin-bottom: 1rem; }
  form { display: grid; gap: 1rem; max-width: 400px; margin: auto; background: #fff; padding: 1rem; border-radius: 12px; }
  label { display: flex; flex-direction: column; }
  input, select { font-size: 18px; padding: 0.6rem; border-radius: 8px; border: 1px solid #ccc; margin-top: 0.4rem; }
  .suggestions { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem; }
  .suggestions span { cursor: pointer; background: #0077cc; color: #fff; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 16px; }
  .checkbox-btn { display: inline-block; padding: 0.5rem 1rem; border: 2px solid #0077cc; border-radius: 10px; cursor: pointer; font-size: 18px; margin-right: 1rem; }
  .checkbox-btn.active { background: #0077cc; color: #fff; }
  button { padding: 0.8rem; font-size: 20px; background: #0077cc; color: #fff; border: none; border-radius: 10px; cursor: pointer; }
  button:hover { background: #005fa3; }
  #status { text-align: center; margin-top: 1rem; font-weight: bold; }
</style>
</head>
<body>
<h1>Rilevazione Presenze e Pasti</h1>

<form id="mealForm">
  <label>Data ingresso
    <input type="date" id="dataIngresso" name="dataIngresso" required>
  </label>

  <label>Ora entrata
    <div class="suggestions" id="entrataSuggerimenti">
      <span data-target="oraEntrata" data-time="07:00">07:00</span>
      <span data-target="oraEntrata" data-time="09:30">09:30</span>
      <span data-target="oraEntrata" data-time="12:00">12:00</span>
      <span data-target="oraEntrata" data-time="16:00">16:00</span>
    </div>
    <input type="time" id="oraEntrata" name="oraEntrata" required>
  </label>

  <label>Ora uscita
    <div class="suggestions" id="uscitaSuggerimenti">
      <span data-target="oraUscita" data-time="22:00">22:00</span>
      <span data-target="oraUscita" data-time="22:30">22:30</span>
      <span data-target="oraUscita" data-time="23:00">23:00</span>
      <span data-target="oraUscita" data-time="23:30">23:30</span>
    </div>
    <input type="time" id="oraUscita" name="oraUscita" required>
  </label>

  <div>
    <span id="btnPranzo" class="checkbox-btn">Pranzo</span>
    <span id="btnCena" class="checkbox-btn">Cena</span>
  </div>

  <button type="button" id="btnInvia">Invia</button>
</form>

<p id="status"></p>

  <!-- PDF -->
<form id="pdfForm" target="_blank" action="https://script.google.com/macros/s/AKfycbxb_Pu9W6w-uDMDsfBqSeAy3WCavXbbPqmoENbk2zc84gCWCzlryfKDS9ccfn_9Ts12/exec" method="get">
  <label>Mese:
    <select name="mese" id="mese">
      <option>Gennaio</option>
      <option>Febbraio</option>
      <option>Marzo</option>
      <option>Aprile</option>
      <option>Maggio</option>
      <option>Giugno</option>
      <option>Luglio</option>
      <option>Agosto</option>
      <option>Settembre</option>
      <option>Ottobre</option>
      <option>Novembre</option>
      <option>Dicembre</option>
    </select>
  </label>
  <label>Anno:
    <select name="anno" id="anno">
      <option>2024</option>
      <option selected>2025</option>
      <option>2026</option>
    </select>
  </label>
  <button type="button" id="btnPDF">Stampaaa PDF</button>
</form>


  

<script>
const status = document.getElementById("status");
const btnPranzo = document.getElementById("btnPranzo");
const btnCena = document.getElementById("btnCena");
let pranzo = false;
let cena = false;

// toggle pranzo/cena
btnPranzo.addEventListener("click", () => {
  pranzo = !pranzo;
  btnPranzo.classList.toggle("active", pranzo);
});
btnCena.addEventListener("click", () => {
  cena = !cena;
  btnCena.classList.toggle("active", cena);
});

// suggerimenti orari
document.querySelectorAll(".suggestions span").forEach(span => {
  span.addEventListener("click", () => {
    const targetId = span.dataset.target;
    const time = span.dataset.time;
    document.getElementById(targetId).value = time;
  });
});

// setta automaticamente la data odierna
window.addEventListener("DOMContentLoaded", () => {
  const today = new Date();
  const yyyy = today.getFullYear();
  let mm = today.getMonth() + 1;
  let dd = today.getDate();
  if (mm < 10) mm = "0" + mm;
  if (dd < 10) dd = "0" + dd;
  document.getElementById("dataIngresso").value = `${yyyy}-${mm}-${dd}`;
});

// invio dati
document.getElementById("btnInvia").addEventListener("click", () => {
  const formData = new FormData();
  formData.append("dataIngresso", document.getElementById("dataIngresso").value);
  formData.append("oraEntrata", document.getElementById("oraEntrata").value);
  formData.append("oraUscita", document.getElementById("oraUscita").value);
  formData.append("pranzo", pranzo);
  formData.append("cena", cena);

  fetch("https://script.google.com/macros/s/AKfycbxiHEJ8RjcvwgQoplK8JPw9VDucZV30CLkLWczx26DcKUj_Pk5f3ZhwrjoeDys5ipUU/exec", {
    method: "POST",
    body: formData
  })
  .then(r => r.json())
  .then(res => {
    if(res.success){
      status.textContent = "✅ Dati salvati nel foglio " + res.sheet;
      pranzo = false; cena = false;
      btnPranzo.classList.remove("active");
      btnCena.classList.remove("active");
      document.getElementById("mealForm").reset();
      // reset data a oggi
      const today = new Date();
      const yyyy = today.getFullYear();
      let mm = today.getMonth() + 1;
      let dd = today.getDate();
      if (mm < 10) mm = "0" + mm;
      if (dd < 10) dd = "0" + dd;
      document.getElementById("dataIngresso").value = `${yyyy}-${mm}-${dd}`;
    } else {
      status.textContent = "❌ Errore: " + res.error;
    }
  })
  .catch(err => {
    status.textContent = "❌ Errore di rete: " + err.message;
  });
});

  //script esportare PDF
  document.getElementById("btnPDF").addEventListener("click", () => {
  const mese = document.getElementById("mese").value;
  const anno = document.getElementById("anno").value;

  const url = `https://script.google.com/macros/s/AKfycbxiHEJ8RjcvwgQoplK8JPw9VDucZV30CLkLWczx26DcKUj_Pk5f3ZhwrjoeDys5ipUU/exec?mese=${mese}&anno=${anno}`;
  
  // apre il PDF in una nuova scheda
  window.open(url, "_blank");
});
</script>
</body>
</html>
